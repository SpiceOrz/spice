'use strict';

const Rule = require('./rule');

var testConfig = require('../../rules/default');
var rule = new Rule(testConfig);

module.exports = function*(next) {
    // 为 true 时，则走本地文件
    let ruleUsed = !false;
    let url = this.parsedUrl.href;

    if (ruleUsed) {
        // to be general rule 本地替换
        let action = yield rule.do(url);

        if(!action) {
            // 匹配失败
            yield next;
        } else {
            action(this);
        }


        // if (!(this.url.match(/get_hw_list/))) {
        //     return yield next;
        // }
        // // new Buffer(String); Object 必须用 JSON.stringify(obj) 来拿到string，不能直接用冒号
        // this.body = {"data":{"end_flag":0,"homework":[{"content":{"c":[{"text":"刚刚-RULE替换的数据","type":"str"}]},"course_id":2,"course_name":"数学","course_pic":"http://p.qpic.cn/qqconadmin/0/8a0b8bcb4c938e2f014c940783ae0002/0","flag":0,"hw_id":1606025239768447,"hw_title":"数学作业","hw_type":0,"icon":"http://p.qpic.cn/qqconadmin/0/8a0b8bcb4c938e2f014c940783ae0002/0","need_feedback":false,"pnick_name":"joey-3","puin":1493815895,"status":0,"team_id":0,"ts_create":1464848122},{"content":{"c":[{"text":"完全","type":"str"}]},"course_id":3,"course_name":"英语","course_pic":"http://p.qpic.cn/qqconadmin/0/8a0b8bcb4c938e2f014c9407d12a0003/0","flag":0,"hw_id":1606015239758253,"hw_title":"英语作业","hw_type":0,"icon":"http://p.qpic.cn/qqconadmin/0/8a0b8bcb4c938e2f014c9407d12a0003/0","need_feedback":false,"pnick_name":"joey","puin":498389246,"status":0,"team_id":0,"ts_create":1464768107},{"content":{"c":[{"text":"啊啊","type":"str"}]},"course_id":3,"course_name":"英语","course_pic":"http://p.qpic.cn/qqconadmin/0/8a0b8bcb4c938e2f014c9407d12a0003/0","flag":0,"hw_id":1606015239798217,"hw_title":"英语作业","hw_type":0,"icon":"http://p.qpic.cn/qqconadmin/0/8a0b8bcb4c938e2f014c9407d12a0003/0","need_feedback":false,"pnick_name":"joey","puin":498389246,"status":0,"team_id":0,"ts_create":1464766387},{"content":{"c":[{"text":"123123123123123\n123123\n","type":"str"}]},"course_id":2,"course_name":"数学","course_pic":"http://p.qpic.cn/qqconadmin/0/8a0b8bcb4c938e2f014c940783ae0002/0","flag":0,"hw_id":1605265239742643,"hw_title":"数学作业","hw_type":0,"icon":"http://p.qpic.cn/qqconadmin/0/8a0b8bcb4c938e2f014c940783ae0002/0","need_feedback":false,"pnick_name":"joey","puin":3201590286,"status":0,"team_id":0,"ts_create":1464227216},{"content":{"c":[{"text":"京津冀","type":"str"}]},"course_id":3,"course_name":"英语","course_pic":"http://p.qpic.cn/qqconadmin/0/8a0b8bcb4c938e2f014c9407d12a0003/0","flag":0,"hw_id":1605205239749596,"hw_title":"英语作业","hw_type":0,"icon":"http://p.qpic.cn/qqconadmin/0/8a0b8bcb4c938e2f014c9407d12a0003/0","need_feedback":false,"pnick_name":"joey","puin":498389246,"status":0,"team_id":0,"ts_create":1463723219},{"content":{"c":[{"text":"啊啊啊","type":"str"}]},"course_id":3,"course_name":"英语","course_pic":"http://p.qpic.cn/qqconadmin/0/8a0b8bcb4c938e2f014c9407d12a0003/0","flag":0,"hw_id":1605205239733397,"hw_title":"英语作业","hw_type":0,"icon":"http://p.qpic.cn/qqconadmin/0/8a0b8bcb4c938e2f014c9407d12a0003/0","need_feedback":false,"pnick_name":"joey","puin":498389246,"status":0,"team_id":0,"ts_create":1463723165},{"content":{"c":[{"text":"在线习题作业（2题）知识点考察：14．1　整式的乘法5．1　相交线","type":"str"}]},"course_id":2,"course_name":"数学","course_pic":"http://p.qpic.cn/qqconadmin/0/8a0b8bcb4c938e2f014c940783ae0002/0","flag":16,"hw_id":1603275239738578,"hw_title":"数学作业","hw_type":0,"icon":"http://p.qpic.cn/qqconadmin/0/8a0b8bcb4c938e2f014c940783ae0002/0","need_feedback":true,"pnick_name":"joey","puin":3201590286,"status":0,"team_id":0,"ts_create":1459054253},{"content":{"c":[{"text":"【文件】","type":"str"}]},"course_id":3,"course_name":"英语","course_pic":"http://p.qpic.cn/qqconadmin/0/8a0b8bcb4c938e2f014c9407d12a0003/0","flag":4,"hw_id":1603165239766357,"hw_title":"英语作业","hw_type":0,"icon":"http://p.qpic.cn/qqconadmin/0/8a0b8bcb4c938e2f014c9407d12a0003/0","need_feedback":true,"pnick_name":"joey","puin":3201590286,"status":0,"team_id":0,"ts_create":1458120298},{"content":{"c":[{"text":"【文件】","type":"str"}]},"course_id":3,"course_name":"英语","course_pic":"http://p.qpic.cn/qqconadmin/0/8a0b8bcb4c938e2f014c9407d12a0003/0","flag":4,"hw_id":1603165239717161,"hw_title":"英语作业","hw_type":0,"icon":"http://p.qpic.cn/qqconadmin/0/8a0b8bcb4c938e2f014c9407d12a0003/0","need_feedback":false,"pnick_name":"joey","puin":3201590286,"status":0,"team_id":0,"ts_create":1458112176},{"content":{"c":[{"text":"123123","type":"str"}]},"course_id":3,"course_name":"英语","course_pic":"http://p.qpic.cn/qqconadmin/0/8a0b8bcb4c938e2f014c9407d12a0003/0","flag":0,"hw_id":1603165239706155,"hw_title":"英语作业","hw_type":0,"icon":"http://p.qpic.cn/qqconadmin/0/8a0b8bcb4c938e2f014c9407d12a0003/0","need_feedback":false,"pnick_name":"joey","puin":3201590286,"status":0,"team_id":0,"ts_create":1458111967},{"content":{"c":[{"text":"知识点考察:Module 1　Our Body and Healthy Habits、Module 2　No Drugs、","type":"str"}]},"course_id":3,"course_name":"英语","course_pic":"http://p.qpic.cn/qqconadmin/0/8a0b8bcb4c938e2f014c9407d12a0003/0","flag":0,"hw_id":1603155239702731,"hw_title":"英语习题","hw_type":2,"icon":"http://p.qpic.cn/qqconadmin/0/8a0b8bcb4c938e2f014c9407d12a0003/0","need_feedback":true,"pnick_name":"joey","puin":3201590286,"status":0,"team_id":0,"ts_create":1458032331},{"content":{"c":[{"text":"知识点考察:一 测量、二 万以内的加法和减法（二）、","type":"str"}]},"course_id":2,"course_name":"数学","course_pic":"http://p.qpic.cn/qqconadmin/0/8a0b8bcb4c938e2f014c940783ae0002/0","flag":0,"hw_id":1603155239714328,"hw_title":"数学习题","hw_type":2,"icon":"http://p.qpic.cn/qqconadmin/0/8a0b8bcb4c938e2f014c940783ae0002/0","need_feedback":true,"pnick_name":"joey","puin":3201590286,"status":0,"team_id":0,"ts_create":1458030243},{"content":{"c":[{"text":"知识点考察:第一章　立体几何初步、","type":"str"}]},"course_id":2,"course_name":"数学","course_pic":"http://p.qpic.cn/qqconadmin/0/8a0b8bcb4c938e2f014c940783ae0002/0","flag":0,"hw_id":1603155239797918,"hw_title":"数学习题","hw_type":2,"icon":"http://p.qpic.cn/qqconadmin/0/8a0b8bcb4c938e2f014c940783ae0002/0","need_feedback":true,"pnick_name":"joey","puin":3201590286,"status":0,"team_id":0,"ts_create":1458027743},{"content":{"c":[{"text":"啊啊","type":"str"}]},"course_id":2,"course_name":"数学","course_pic":"http://p.qpic.cn/qqconadmin/0/8a0b8bcb4c938e2f014c940783ae0002/0","flag":0,"hw_id":1603155239737562,"hw_title":"数学作业","hw_type":0,"icon":"http://p.qpic.cn/qqconadmin/0/8a0b8bcb4c938e2f014c940783ae0002/0","need_feedback":false,"pnick_name":"joey","puin":3201590286,"status":0,"team_id":0,"ts_create":1458027702},{"content":{"c":[{"text":"作文要求：现在越来越多的学生带手机上学。虽然联系方便，但也给学生们的学习和课堂秩序造成了一定的影响，分散了学生学习的注意力。就【中学生带手机上学】这一话题谈一谈带手机上学的利弊。首段已给出： 词数：120-150. 参考词汇：cell phone手机；convenient 方便的； distract 分散(注意力)    Carrying Cell phones to School for Students      Nowadays more and more students carry cell phones to school. In my opinion, there&#39;re both advantages and disadvantages for students to ","type":"str"}]},"course_id":3,"course_name":"英语","course_pic":"http://p.qpic.cn/qqconadmin/0/8a0b8bcb4c938e2f014c9407d12a0003/0","flag":16,"hw_id":1602185239752786,"hw_title":"英语作业","hw_type":0,"icon":"http://p.qpic.cn/qqconadmin/0/8a0b8bcb4c938e2f014c9407d12a0003/0","need_feedback":true,"pnick_name":"joey","puin":498389246,"status":0,"team_id":0,"ts_create":1455783285},{"content":{"c":[{"text":"test","type":"str"}]},"course_id":100,"course_name":"aaa","course_pic":"http://p.qpic.cn/qqconadmin/0/8a0b8bcb4d512461014d527fc2520002/0","flag":0,"hw_id":1511255239777536,"hw_title":"aaa作业","hw_type":0,"icon":"http://p.qpic.cn/qqconadmin/0/8a0b8bcb4d512461014d527fc2520002/0","need_feedback":false,"pnick_name":"joey","puin":3201590286,"status":0,"team_id":0,"ts_create":1448439033},{"content":{"c":[{"text":"【图片】","type":"str"}]},"course_id":2,"course_name":"数学","course_pic":"http://p.qpic.cn/qqconadmin/0/8a0b8bcb4c938e2f014c940783ae0002/0","flag":1,"hw_id":1511175239765337,"hw_title":"数学作业","hw_type":0,"icon":"http://p.qpic.cn/qqconadmin/0/8a0b8bcb4c938e2f014c940783ae0002/0","need_feedback":false,"pnick_name":"joey","puin":3201590286,"status":0,"team_id":0,"ts_create":1447758762},{"content":{"c":[{"text":"test","type":"str"}]},"course_id":2,"course_name":"数学","course_pic":"http://p.qpic.cn/qqconadmin/0/8a0b8bcb4c938e2f014c940783ae0002/0","flag":0,"hw_id":1511175239709813,"hw_title":"数学作业","hw_type":0,"icon":"http://p.qpic.cn/qqconadmin/0/8a0b8bcb4c938e2f014c940783ae0002/0","need_feedback":false,"pnick_name":"joey","puin":3201590286,"status":0,"team_id":0,"ts_create":1447746692},{"content":{"c":[{"text":"阿斯大苏打","type":"str"}]},"course_id":1,"course_name":"语文","course_pic":"http://p.qpic.cn/qqconadmin/0/8a0b8bcb4c938e2f014c94070dcc0001/0","flag":0,"hw_id":1511175239723230,"hw_title":"语文作业","hw_type":0,"icon":"http://p.qpic.cn/qqconadmin/0/8a0b8bcb4c938e2f014c94070dcc0001/0","need_feedback":false,"pnick_name":"joey","puin":3201590286,"status":0,"team_id":0,"ts_create":1447746365},{"content":{"c":[{"text":"141414","type":"str"}]},"course_id":2,"course_name":"数学","course_pic":"http://p.qpic.cn/qqconadmin/0/8a0b8bcb4c938e2f014c940783ae0002/0","flag":0,"hw_id":1511175239742141,"hw_title":"数学作业","hw_type":0,"icon":"http://p.qpic.cn/qqconadmin/0/8a0b8bcb4c938e2f014c940783ae0002/0","need_feedback":false,"pnick_name":"joey","puin":3201590286,"status":0,"team_id":0,"ts_create":1447746057}],"identity":1,"server_time":1467343583},"msg":"success","retcode":0}; // 必须字符串，否则会乱码
    } else {
        yield next;
    }
}
